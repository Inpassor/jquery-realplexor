/**
 * jquery-realplexor.js
 *
 * @author DmitryKoterov <dmitry.koterov@gmail.com>
 * @link https://github.com/DmitryKoterov/dklab_realplexor/blob/master/dklab_realplexor.js
 *
 * @author Inpassor <inpassor@yandex.com>
 * @link https://github.com/Inpassor/yii2-realplexor
 *
 * @version 0.1.1 (2016.10.11)
 */
(function(e,k,g,l){var f={};e.Realplexor=function(a){if(e.isPlainObject(a))return new h(a);if(f[a])return f[a];throw"Invalid parameters.";};e.Realplexor._iframeLoaded=function(a){var b=f[a];setTimeout(function(){var c=g.getElementById(a);b._realplexor=c.contentWindow.Dklab_Realplexor_Loader;b.needExecute&&b.execute()},50)};e.Realplexor._callAndReturnException=function(a,b){try{return a.apply(null,b),null}catch(c){return""+c}};var h=function(a){e.extend(!0,this,a||{});this.host=g.location.host;this.uid=
a.uid||"mpl"+(new Date).getTime();f[this.uid]=this;if(!this.url.match(/^\/\/([^/]+)/))throw"Dklab_Realplexor constructor argument must be fully-qualified URL, "+this.url+" given.";a=RegExp.$1;if(a!=this.host&&a.lastIndexOf("."+this.host)!=a.length-this.host.length-1)throw"Due to the standard XMLHttpRequest security policy, hostname in URL passed to Dklab_Realplexor ("+a+") must be equals to the current host ("+this.host+") or be its direct sub-domain.";this.createIframe&&this._createIframe();g.domain=
this.host;return this};h.prototype={version:"1.32",uid:null,url:"",host:"",namespace:"",_map:{},_realplexor:null,_login:null,_iframeCreated:!1,_needExecute:!1,_executeTimer:null,_createIframe:function(){e("<iframe/>",{id:this.uid,onload:'$.Realplexor._iframeLoaded("'+this.uid+'")',src:this.url+"?identifier=IFRAME&HOST="+this.host+"&version="+this.version}).css({position:"absolute",visibility:"hidden",width:"200px",height:"200px",left:"-1000px",top:"-1000px"}).appendTo("body");this._iframeCreated=
!0},logon:function(a){this._login=a;return this},setCursor:function(a,b){this._map[a]||(this._map[a]={cursor:null,callbacks:[]});this._map[a].cursor=b;return this},subscribe:function(a,b){this._map[a]||(this._map[a]={cursor:null,callbacks:[]});for(var c=this._map[a].callbacks,d=0;d<c.length;d++)if(c[d]===b)return this;c.push(b);return this},unsubscribe:function(a,b){if(!this._map[a])return this;if(null==b)return this._map[a].callbacks=[],this;for(var c=this._map[a].callbacks,d=0;d<c.length;d++)if(c[d]===
b){c.splice(d,1);break}return this},execute:function(){this._iframeCreated||this._createIframe();this._executeTimer&&(clearTimeout(this._executeTimer),this._executeTimer=null);var a=this;if(!this._realplexor)return this._executeTimer=setTimeout(function(){a.execute()},30),this;this._realplexor.execute(this._map,this._callAndReturnException,(null!=this._login?this._login+"_":"")+this.namespace);return this}}})(jQuery,window,document);